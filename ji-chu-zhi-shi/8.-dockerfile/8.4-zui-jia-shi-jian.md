# 8.4 最佳实践

* **精简镜像用途**：尽量让每个镜像的用途都比较集中单一，避免构造大而复杂、多功能的镜像；
* **选用合适的基础镜像**：容器的核心是应用。选择过大的父镜像（如Ubuntu系统镜像）会造成最终生成应用镜像的臃肿，推荐选用瘦身过的应用镜像（如node:slim），或者较为小巧的系统镜像（如alpine、busybox或debian）；
* **提供注释和维护者信息**：Dockerfile也是一种代码，需要考虑方便后续的扩展和他人的使用；
* **正确使用版本号**：使用明确的版本号信息，如1.0,2.0，而非依赖于默认的latest。通过版本号可以避免环境不一致导致的问题；
* **减少镜像层数**：如果希望所生成镜像的层数尽量少，则要尽量合并RUN、ADD和COPY指令。通常情况下，多个RUN指令可以合并为一条RUN指令；
* **恰当使用多步骤创建**（17.05+版本支持）：通过多步骤创建，可以将编译和运行等过程分开，保证最终生成的镜像只包括运行应用所需要的最小化环境。当然，用户也可以通过分别构造编译镜像和运行镜像来达到类似的结果，但这种方式需要维护多个Dockerfile。
* **使用.dockerignore文件**：使用它可以标记在执行docker build时忽略的路径和文件，避免发送不必要的数据内容，从而加快整个镜像创建过程。
* **及时删除临时文件和缓存文件**：特别是在执行apt-get指令后，/var/cache/apt下面会缓存了一些安装包；
* **提高生成速度**：如合理使用cache，减少内容目录下的文件，或使用.dockerignore文件指定等；
* **调整合理的指令顺序**：在开启cache的情况下，内容不变的指令尽量放在前面，这样可以尽量复用；
* **减少外部源的干扰**：如果确实要从外部引入数据，需要指定持久的地址，并带版本信息等，让他人可以复用而不出错。
