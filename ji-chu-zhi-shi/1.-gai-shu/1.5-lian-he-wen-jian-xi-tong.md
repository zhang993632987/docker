# 1.5 联合文件系统

<mark style="color:blue;">**联合文件系统（UnionFS）**</mark>是一种轻量级的高性能**分层文件系统**，它支持将文件系统中的修改信息作为一次提交，并层层叠加，同时可以将不同目录挂载到同一个虚拟文件系统下，应用看到的是挂载的最终结果。联合文件系统是实现Docker镜像的技术基础。

Docker镜像自身就是由多个文件层组成，每一层有基于内容的唯一的编号（层ID）。可以通过**docker history**查看一个镜像由哪些层组成。对于Docker镜像来说，这些层的内容都是不可修改的、只读的。而**当Docker利用镜像启动一个容器时，将在镜像文件系统的最顶端再挂载一个新的可读写的层给容器**。容器中的内容更新将会发生在可读写层。当所操作对象位于较深的某层时，需要先复制到最上层的可读写层。当数据对象较大时，往往意味着较差的IO性能。因此，<mark style="color:orange;">**对于IO敏感型应用，一般推荐将容器修改的数据通过volume方式挂载，而不是直接修改镜像内数据。**</mark>

Docker目前支持的联合文件系统种类包括**AUFS**、**btrfs**、**Device Mapper**、**overlay**、**overlay 2**、**vfs**、**zfs**等。多种文件系统目前的支持情况总结如下：

* **AUFS**：最早支持的文件系统，对Debian/Ubuntu支持好，虽然没有合并到Linux内核中，但成熟度很高；
* **btrfs**：参考zfs等特性设计的文件系统，由Linux社区开发，试图未来取代Device Mapper，成熟度有待提高；
* **Device Mapper**：RedHat公司和Docker团队一起开发用于支持RHEL的文件系统，内核支持，性能略慢，成熟度高；
* **overlay**：类似于AUFS的层次化文件系统，性能更好，从Linux 3.18开始已经合并到内核，但成熟度有待提高；
* **overlay 2**：Docker 1.12后推出，原生支持128层，效率比OverlayFS高，较新版本的Docker支持，要求内核大于4.0；
* **vfs**：基于普通文件系统（ext、nfs等）的中间层抽象，性能差，比较占用空间，成熟度也一般。

<mark style="color:orange;">**目前，AUFS应用最为广泛，支持也相对成熟，推荐生产环境考虑。**</mark>

{% hint style="info" %}
所有的镜像和容器都存储都在Docker指定的存储目录下，以Ubuntu宿主系统为例，默认路径是/**var/lib/docker**。在这个目录下面，存储由Docker镜像和容器运行相关的文件和目录。
{% endhint %}
